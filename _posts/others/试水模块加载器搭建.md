# 试水模块加载器框架搭建

> CMD是我个人用着比较爽的加载模式，用起来跟node的模块很像。
> 我简单的脑补并实现了CMD的部分用例。

##什么是模块加载器

这也是时代的产物，当前端工程变得越来越庞大，需要管理代码和依赖的工具，于是有了模块加载器。每一种模块加载器可能实现一种或者多种模块加载规范。

加载规范有很多种，commenJS，AMD，CMD，KMD。我个人喜欢CMD，CMD是玉伯在提出来的，CMD就是你想要什么模块实时的require，就像node那样。

##我的实现方案

代码托管在[我的github](http://github.com/shaomingquan/CMD)上。本文例子在lite_version分支上。

框架实现在`/src/lib/earth.js`（玉伯大大的是sea，我取名earth= =）。用例是`/index.html`。

简述一下这个用例，首先是配置一下模块根路径base，和路径别名alias。然后载入项目入口`/src/scripts/index.js`，这里使用别名index替代。然后在index.js加载`/src/modules/helloworld.js`模块。然后使用获得的功能（这是个简单的dom渲染函数）。

所谓加载器也就是把脚本引入，Earth.use方法中采用异步引用，代码如下所示。

	var scriptsStage = document.getElementsByTagName("head")[0] || document.getElementsByTagName("body")[0];
	var newScriptTag = document.createElement("script");
	newScriptTag.src = /\w+.js^/.test(id) ? id : id + ".js";
	newScriptTag.onload = callback;
	scriptsStage.appendChild(newScriptTag);	
require方法采用同步加载。使用Ajax get同步模式，并将返回的内容使用eval函数执行，这样就会有一个返回值。代码如line35,line59。

然后在define函数中生成require，exports，module实例，作为回调函数的参数，让回调函数执行，拿到返回值。define内抛出API的方法有三种，return，exports，module.exports，至于优先级，我选择我个人越不常用的方式优先级越高。代码如line77。

##拜读seajs源码


